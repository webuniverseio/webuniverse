apt-get install -y ssh

http://www.pontikis.net/blog/debian-wheezy-web-server-setup:
	passwd
	apt-get update && apt-get -V upgrade
	updatedb
	nano /etc/environment
		EDITOR=nano
	nano /etc/nanorc
		set const
	
	adduser sergey
	use puttygen to create new keys or use load to load existing keys
	login as sergey
		nano ~/.ssh/authorized_keys - paste public key
		set 700 for .ssh and 600 for authorized_keys
	verify authorization, switch to root
	use pagent for convenience
	
	apt-get install -y systemd
	nano /etc/default/grub
		GRUB_CMDLINE_LINUX_DEFAULT="nomodeset init=/bin/systemd"
	update-grub && reboot
	
	apt-get install -y ntp
	dpkg-reconfigure tzdata
		America, Toronto
	systemctl restart cron.service
	*reboot
	
	nano /etc/apt/sources.list
		deb http://download.webmin.com/download/repository sarge contrib
	cd /root
		wget http://www.webmin.com/jcameron-key.asc
		apt-key add jcameron-key.asc
	apt-get update
	apt-get install -y webmin
		go to https://domain:10000/, proceed
		install updates
		create a separate user instead of root
		webmin configuration -> ssl -> self-signed certificates -> enter country code -> create
		refresh page, proceed, webmin configuration -> ssl -> current -> save PKCS12 format
		open manage computer certificates -> trusted root -> right click certificates -> import, restart browser

	ssl - nano /etc/ssh/sshd_config
		...
		Port 3871
		PermitRootLogin no
		X11Forwarding no
		AllowUsers sergey ...
		PasswordAuthentication no
		...
		systemctl restart ssh.service

	check /etc/hostname and /etc/hosts for right domain name

	kernel - nano /etc/sysctl.d/local.conf
		# sysctl config
		#net.ipv4.ip_forward=1
		net.ipv4.conf.all.rp_filter=1
		net.ipv4.icmp_echo_ignore_broadcasts=1
		net.ipv4.tcp_syncookies = 1
		# ipv6 settings (no autoconfiguration)
		net.ipv6.conf.default.autoconf=0
		net.ipv6.conf.default.accept_dad=0
		net.ipv6.conf.default.accept_ra=0
		net.ipv6.conf.default.accept_ra_defrtr=0
		net.ipv6.conf.default.accept_ra_rtr_pref=0
		net.ipv6.conf.default.accept_ra_pinfo=0
		net.ipv6.conf.default.accept_source_route=0
		net.ipv6.conf.default.accept_redirects=0
		net.ipv6.conf.default.forwarding=0
		net.ipv6.conf.all.autoconf=0
		net.ipv6.conf.all.accept_dad=0
		net.ipv6.conf.all.accept_ra=0
		net.ipv6.conf.all.accept_ra_defrtr=0
		net.ipv6.conf.all.accept_ra_rtr_pref=0
		net.ipv6.conf.all.accept_ra_pinfo=0
		net.ipv6.conf.all.accept_source_route=0
		net.ipv6.conf.all.accept_redirects=0
		net.ipv6.conf.all.forwarding=0
		kernel.core_uses_pid = 1
        kernel.sysrq = 0
        net.ipv4.conf.all.log_martians = 1
        net.ipv4.conf.all.send_redirects = 0
        net.ipv4.conf.default.accept_redirects = 0
        net.ipv4.conf.default.accept_source_route = 0
        net.ipv4.conf.default.log_martians = 1
        net.ipv4.tcp_timestamps = 0
	reboot

	apt-get install exim4
		dpkg-reconfigure exim4-config
			internet site (* smarthost; no local mail)
			system name - webuniverse.ca
			ip-addresses - blank (* 127.0.0.1; ::1)
			other destinations - blank (*mail.webuniverse.ca)
			visible domain - blank (* webuniverse.ca)
			outgoing smarthost 198.187.29.228::26
			...

	Forward root mail - nano /etc/aliases
		...
		root:serge.zarouski@gmail.com
	newaliases
	don't forget to configure exim passwords

	nano /etc/iptables.up.rules
		# Generated by iptables-save v1.4.14 on Fri May 17 20:09:12 2013
		*filter
		:INPUT DROP [0:0]
		:FORWARD ACCEPT [0:0]
		:OUTPUT ACCEPT [189:103951]
		-A INPUT ! -i eth0 -j ACCEPT
		-A INPUT -p tcp -m tcp --tcp-flags ACK ACK -j ACCEPT
		-A INPUT -m state --state ESTABLISHED -j ACCEPT
		-A INPUT -m state --state RELATED -j ACCEPT
		-A INPUT -p udp -m udp --sport 53 --dport 1024:65535 -j ACCEPT
		-A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT
		-A INPUT -p icmp -m icmp --icmp-type 3 -j ACCEPT
		-A INPUT -p icmp -m icmp --icmp-type 4 -j ACCEPT
		-A INPUT -p icmp -m icmp --icmp-type 11 -j ACCEPT
		-A INPUT -p icmp -m icmp --icmp-type 12 -j ACCEPT
		-A INPUT -p tcp -m tcp --dport 3871 -j ACCEPT
		-A INPUT -p tcp -m tcp --dport 113 -j ACCEPT
		-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
		-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
		-A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
		-A INPUT -p tcp -m tcp -m multiport --dports 25,587 -j ACCEPT
		-A INPUT -p tcp -m tcp --dport 10000:10010 -j ACCEPT
		-A INPUT -j LOG
		-A FORWARD -j LOG
		COMMIT
		# Completed on Fri May 17 20:09:12 2013
		# Generated by iptables-save v1.4.14 on Fri May 17 20:09:12 2013
		*mangle
		:PREROUTING ACCEPT [49770:4531554]
		:INPUT ACCEPT [49770:4531554]
		:FORWARD ACCEPT [0:0]
		:OUTPUT ACCEPT [48931:39133213]
		:POSTROUTING ACCEPT [48931:39133213]
		COMMIT
		# Completed on Fri May 17 20:09:12 2013
		# Generated by iptables-save v1.4.14 on Fri May 17 20:09:12 2013
		*nat
		:PREROUTING ACCEPT [4223:278291]
		:INPUT ACCEPT [1650:94585]
		:OUTPUT ACCEPT [2836:192019]
		:POSTROUTING ACCEPT [2836:192019]
		COMMIT
		# Completed on Fri May 17 20:09:12 2013
	iptables-restore < /etc/iptables.up.rules
	nano /etc/network/interfaces
		...
		post-up iptables-restore < /etc/iptables.up.rules

	nano /etc/ip6tables.up.rules
    		*filter
    		-A INPUT -j LOG
    		-A FORWARD -j LOG
    		COMMIT

    	ip6tables-restore < /etc/ip6tables.up.rules
    	nano /etc/network/interfaces
    		...
    		post-up ip6tables-restore < /etc/ip6tables.up.rules

	apt-get install -y git mc p7zip-full htop sysstat

	apt-get install -y logwatch
	mkdir /var/cache/logwatch
	cp /usr/share/logwatch/default.conf/logwatch.conf /etc/logwatch/conf/
	nano /etc/logwatch/conf/logwatch.conf
		#Output = stdout
		Output = mail

		custom logs
			New Service

	            The goal was to add the logs of my backup scripts in /var/log/backup/ to the logwatch reports. First you have to define a log file group. This tells logwatch which files to read.

	            # /etc/logwatch/conf/logfiles/my-backup.conf

	            # The LogFile path is relative to /var/log by default.
	            # You can change the default by setting LogDir.
	            LogFile = backup/*.log

	            # This enables searching through zipped archives as well.
	            Archive = backup/*.gz

	            # Expand the repeats (actually just removes them now).
	            *ExpandRepeats
	            Next you need to create a service that will use the log file group.

	            # /etc/logwatch/conf/services/my-backup.conf

	            # The title shown in the report.
	            Title = "My Backups"

	            # The name of the log file group (file name).
	            LogFile = my-backup
	            Finally, you need a script to parse the log files. I�ve seen a lot of examples in perl, but I prefer bash for simple scripts. Note that the script has the same name as the service file.

	            #!/usr/bin/env bash
	            # /etc/logwatch/scripts/services/my-backup

	            # Change the line separator to split by new lines.
	            OLD_IFS=$IFS
	            IFS=$'\n'

	            # The contents of the log file are given in stdin.
	            for LINE in $( cat /dev/stdin ); do

	                # Only lines matching this regexp will be included.
	                if echo $LINE|egrep 'info' &> /dev/null; then

	                    # Every line we echo here will be included in the logwatch report.
	                    echo $LINE

	                fi

	            done

	            IFS=$OLD_IFS
	            And you�re done! The contents of the backup log files will show up in the logwatch reports under �My Backups�.

            Log Rotation

	            If you don�t want your logwatch reports to forever grow in size, you also need to rotate the log files. Logrotate will conveniently do that for you with this simple configuration.

	            # /etc/logrotate.d/backup

	            /var/log/backup/*log {

	                daily

	                # keep 10 old logs
	                rotate 10

	                # don't do anything if the log is missing
	                missingok

	                # don't do anything if the log is empty
	                notifempty

	                # zip the archived logs
	                compress
	            }

	apt-get install fail2ban (http://www.pontikis.net/blog/fail2ban-install-config-debian-wheezy)
		nano /etc/fail2ban/jail.local
			[DEFAULT]
			ignoreip  = 127.0.0.1
			bantime   = 86400
			banaction = iptables-multiport
			action  = %(action_mwl)s

			# JAILS
			[ssh]
			enabled   = true
			maxretry  = 3

			[pam-generic]
			enabled   = true
			banaction = iptables-allports

			[ssh-ddos]
			enabled   = true

			[webmin]
			enabled   = true
			port      = 10000,20000
			filter  = webmin-auth
			banaction = iptables-multiport
			action  = %(action_mwl)s
			logpath   = /var/log/auth.log
			maxretry  = 3

			[exim]
			enabled  = true
			filter   = exim
			port     = smtp,ssmtp
			logpath  = /var/log/exim*/rejectlog
			maxretry = 1
	systemctl start fail2ban.service
	Restart after system crash:
		nano /etc/default/fail2ban
			FAIL2BAN_OPTS="-x"
	Notification mail settings:
		nano /etc/fail2ban/action.d/sendmail-whois-lines.conf

	apt-get install psad (http://www.pontikis.net/blog/psad-install-config-debian-wheezy)
		nano /etc/psad/psad.conf
			HOSTNAME                    cosmos.medisign.com;
			HOME_NET                    NOT_USED;
			IPT_SYSLOG_FILE          /var/log/kern.log;
			EMAIL_LIMIT_STATUS_MSG    N;
			ENABLE_AUTO_IDS          Y;
			AUTO_IDS_DANGER_LEVEL      3;
			AUTO_BLOCK_TIMEOUT        86400;
			ENABLE_AUTO_IDS_EMAILS    N;
			mailCmd       /usr/bin/mail;
		Whitelist - blacklist
		You can blacklist an IP (value = 5) or whitelist an IP (value = 0)
		nano /etc/psad/auto_dl
			127.0.0.1      0;         # Server IP.
			144.76.70.100      0;         # Server IP.
			95.211.47.207      0;         # Management IP.
			82.192.71.9    0;         # Management IP.
		systemctl restart psad.service
		Update signatures periodically:
			crontab -e
				@weekly /usr/sbin/psad --sig-update && /usr/sbin/psad -H | mail -s "psad signatures updated on WebUniverse" serge.zarouski@gmail.com  # Weekly update of psad signatures

	apt-get install -y acl (TODO: research)

	apt-get install -y rkhunter
		http://habrahabr.ru/company/first/blog/242865/
		nano /etc/default/rkhunter
		rkhunter -c --enable all --disable none
		rkhunter --propupd
		rkhunter --update

	apt-get install -y lynis
	lynis -c

	apt-get install apticron (http://www.pontikis.net/blog/simple-steps-to-update-a-debian-server)
		apt-get install update-notifier-common
			see if security updates
				/usr/lib/update-notifier/apt-check --human-readable
			see if reboot required
				/usr/lib/update-notifier/update-motd-reboot-required
		apt-get install debian-goodies
			checkrestart


	apt-get update && apt-get -V upgrade
	updatedb

http://www.leonardoborda.com/blog/how-to-configure-sysstatsar-on-ubuntudebian/

https://tipstricks.itmatrix.eu/disabling-the-flood-of-kernel-messages-in-debian-lenny-console/
	nano /etc/sysctl.conf
		kernel.printk = 4 1 1 7
	/sbin/sysctl -p /etc/sysctl.conf

https://github.com/joyent/node/wiki/installing-node.js-via-package-manager:
	apt-get install -y curl
	curl -sL https://deb.nodesource.com/setup | bash -
	apt-get install -y nodejs
	apt-get install -y build-essential

npm i n -g
	n stable
	n latest

npm i nave -g
	nave usemain "stable"

adding new user (like for node processes)
https://serversforhackers.com/initial-security/
add user to sudoers

https://serversforhackers.com/log-rotate/ (also check webmin)

docker
	nano /etc/apt/sources.list
	deb http://http.debian.net/debian wheezy-backports main
	apt-get update
	apt-get install -y -t wheezy-backports linux-image-amd64
	curl -sSL https://get.docker.com/ | sh
	docker run -d -p 127.0.0.1:5000:5000 registry
	docker pull debian
	docker tag debian localhost:5000/debian
	docker push localhost:5000/debian
	docker run -d -P localhost:5000/debian
	setup tunnel in putty
		port:5000
		destination: 127.0.0.1:5000
		local

http://stackoverflow.com/questions/12594541/npm-global-install-cannot-find-module
NODE_PATH=/usr/local/lib/node_modules/ path to global node_modules folder

PM2
	https://github.com/Unitech/PM2/blob/master/ADVANCED_README.md
	https://serversforhackers.com/log-rotate/ - pm2 reloadLogs

http-master
	https://www.digitalocean.com/community/tutorials/how-to-install-and-use-goaccess-web-log-analyzer-with-apache-on-debian-7
	apt-get install libncurses5-dev
	touch report.sh
		cd /home/node/node_projects/http-master-logs
		cat webuniverse.log | /usr/local/bin/goaccess -a -d > webuniverse.html
		...
		echo "Daily access report" | mutt -a "webuniverse.html" -s "Access log report" -- root@localhost
	crontab -e
		@daily cd /home/node/node_projects/http-master-logs&&./report.sh
	logrotate

https://developers.facebook.com/tools/debug/og/object/
	canonical url - remove index.html? (same for http://webuniverse.io/index.html)

git
	http://www.abeautifulsite.net/how-to-delete-a-tag-on-github/
	http://mherman.org/blog/2013/09/16/managing-multiple-github-accounts/


linkedin
echo.js
facebook
google+?
hacker news?
https://jslive.com/
https://www.twilio.com/blog/2015/04/get-notified-when-someone-posts-an-article-from-your-domain-on-hacker-news-using-node-js-firebase-and-twilio.html?utm_source=javascriptweekly&utm_medium=email