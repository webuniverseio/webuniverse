<!doctype html> <html lang="en" class="no-js"> <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#"> <meta http-equiv="x-dns-prefetch-control" content="on"> <link rel="dns-prefetch" href="//webuniverse.disqus.com"> <link rel="dns-prefetch" href="//a.disquscdn.com"> <link rel="dns-prefetch" href="//disqus.com"> <link rel="dns-prefetch" href="//glitter-services.disqus.com"> <link rel="dns-prefetch" href="//referrer.disqus.com"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@webuniverseio"> <meta property="og:url" content="http://webuniverse.io/cyclomatic-complexity-refactoring-tips/index.html"> <meta name="twitter:url" content="http://webuniverse.io/cyclomatic-complexity-refactoring-tips/index.html"> <meta property="og:title" content="Cyclomatic complexity refactoring tips for javascript developers | Web Universe"> <meta name="twitter:title" content="Cyclomatic complexity refactoring tips for javascript developers | Web Universe"> <meta property="og:site_name" content="Web Universe"> <meta property="og:type" content="article"> <meta property="article:publisher" content="https://www.facebook.com/webuniverseio"> <meta property="article:published_time" content="2015-10-23T00:00:00-04:00"> <meta name="description" content="Learn how to make your code much easier for reading and writing through management of cyclomatic complexity"> <meta property="og:description" content="Learn how to make your code much easier for reading and writing through management of cyclomatic complexity"> <meta name="twitter:description" content="Learn how to make your code much easier for reading and writing through management of cyclomatic complexity"> <meta property="og:image" content="http://webuniverse.io/cyclomatic-complexity-refactoring-tips/image.jpg"> <meta name="twitter:image" content="http://webuniverse.io/cyclomatic-complexity-refactoring-tips/image.jpg"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="format-detection" content="telephone=no"> <meta charset="utf-8"> <!--[if lte IE 8]><meta http-equiv="refresh" content="0;URL='https://browser-update.org/update.html'" /><![endif]--> <title>Cyclomatic complexity refactoring tips for javascript developers | Web Universe</title> <script>document.documentElement.className=document.documentElement.className.replace("no-js",""),document.createElement("picture");</script><link rel="canonical" href="http://webuniverse.io/cyclomatic-complexity-refactoring-tips/index.html"> <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"> <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"> <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"> <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"> <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"> <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"> <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"> <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"> <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192"> <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160"> <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"> <meta name="msapplication-TileColor" content="#2b5797"> <meta name="msapplication-TileImage" content="/mstile-144x144.png"> <link rel="alternative" href="/atom.xml" title="Web Universe" type="application/atom+xml"> <link rel="stylesheet" href="/static/dest/css/main.css?v=10"> </head></html> <body itemscope itemtype="http://schema.org/WebPage"> <meta itemprop="typicalAgeRange" content="17-"> <div id="page__wrapper"> <div id="page__layout-base"> <header id="page__header" role="banner"> <a href="/"> <h1 class="logo" itemprop="name"> Web <span class="logo__universe">Universe</span> </h1> </a> </header> <div id="page-content__wrapper"> <div id="page-content"> <div id="top-bar" class="ov-h"> <nav class="navigation decorate-links-on-hover column" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"> <h2 class="a11y__element">Main navigation</h2> <a href="#page-content__main" class="a11y__skip navigation__skip">skip navigation</a> <a href="/" itemprop="url"> <span itemprop="name">Home</span></a> <span class="navigation__separator"></span> <a href="/about/" itemprop="url"> <span itemprop="name">About</span></a> <span class="navigation__separator"></span> <a href="/projects/" itemprop="url"> <span itemprop="name">Projects</span></a> <span class="navigation__separator"></span> <a href="/recommended/" itemprop="url"> <span itemprop="name">Recommended</span></a> <span class="navigation__separator"></span> <a href="/contact/" itemprop="url"> <span itemprop="name">Contact</span></a> </nav> <div class="column"> <section> <h3 class="a11y__element">Search panel</h3> <div class="gcse-search" style="height:33px"></div> </section> </div> </div> <main id="page-content__main" tabindex="0" class="page-content__side-padding ov-h"> <div class="article" itemscope itemtype="http://schema.org/Article" id="post-cyclomatic-complexity-refactoring-tips" class="article"> <article class="content-entry" itemprop="articleBody"> <div class="article__image-wrapper"> <picture> <!--[if IE 9]><video style="display: none;"><![endif]--> <source srcset="image.jpg" media="(min-width: 600px)"> <!--[if IE 9]></video><![endif]--> <img srcset="imageSmall.jpg" alt="Cyclomatic complexity refactoring tips for javascript developers"> </source></picture> </div> <h1 itemprop="name" class="article__title">Cyclomatic complexity refactoring tips for javascript developers</h1> <time class="datetime" datetime="2015-10-23T04:00:00.000Z" itemprop="datePublished"> 23 October, 2015 </time> <meta itemprop="datePublished" content="2011-05-08T19:30"> <p>This article briefly explains what is cyclomatic complexity and gives practical tips about how to make your projects maintainable.</p> <h2 id="Cyclomatic_complexity">Cyclomatic complexity</h2><p>In short cyclomatic complexity is a number which indicates how many execution scenarios there might be inside your code. Everyday developers read lots of code and during this process they try to imagine what the code is doing. The more execution scenarios they see in the code, the harder it is to keep track of what is going on. That leads to misunderstanding and therefore to hacks and buggy implementations. Conditional operators increase cyclomatic complexity, so it is a matter of keeping them under control. Following operators will increase cyclomatic complexity in javascript:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if | while | for | case | || | catch | ternary operator ?:</span><br></pre></td></tr></table></figure></p> <p>Below is an example of how you don’t want your code to look as it will be too complex to understand:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">    <span class="keyword">while</span> (condition ? expression : expression) &#123;</span><br><span class="line">      <span class="keyword">if</span> (condition || condition &amp;&amp; condition) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//... a few more conditions like this and there is a 100% chance that we'll need a debugger today</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <h2 id="Functions_as_a_way_to_reduce_complexity">Functions as a way to reduce complexity</h2><p>We break down code into functions not only to make sure that we don’t repeat ourselves, but also to define a scoped scenario which we can understand more easily. If code inside function was written without side effects (does only one thing and exactly what it says it does - that is what we’re expecting from APIs which does not belong to us, right? :)), it is enough for us take a look at function’s name to get the idea about what it is doing.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isInstalled()) &#123;</span><br><span class="line">    chooseInstallProcess();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isInstalled</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chooseInstallProcess</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (shouldSkipDownload()) &#123;</span><br><span class="line">    installProgram();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    downloadAndInstall();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shouldSkipDownload</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadAndInstall</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  downloadProgram();</span><br><span class="line">  installProgram();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadProgram</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">installProgram</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p> <p>It is much easier to read code which is broken into smaller functions, isn’t it? Small functions alone will improve readability of your code and make whole app much more stable and maintainable. <strong>When we split code into functions we split cyclomatic complexity.</strong></p> <h2 id="Tools">Tools</h2><p>Code analysis tools like <a href="http://eslint.org/docs/rules/complexity.html" target="_blank" rel="external">eslint</a> or <a href="http://jshint.com/docs/options/#maxcomplexity" target="_blank" rel="external">jshint</a> will help you to find the value of cyclomatic complexity per each function. All you need to do is to define a max value after which they’ll start logging errors. My personal preference for max complexity is 3 as it will guarantee that my functions will be small. Code below will fail complexity check:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//cyclomatic complexity always starts from 1</span></span><br><span class="line">  <span class="keyword">if</span> (firstName &amp;&amp; lastName) &#123; <span class="comment">//if operator, +1</span></span><br><span class="line">    <span class="keyword">return</span> firstName + <span class="string">' '</span> + lastName;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (firstName) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">return</span> firstName;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lastName) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">return</span> lastName;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!firstName &amp;&amp; !lastName) &#123; <span class="comment">// +1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'stranger'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//total complexity is 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <p>And following code will pass:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNameOrFallback</span>(<span class="params">name, fallback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//complexity starts from 1</span></span><br><span class="line">  <span class="keyword">return</span> name || fallback; <span class="comment">//|| operator, +1</span></span><br><span class="line">  <span class="comment">//total complexity is 2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">firstName, lastName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//complexity starts from 1</span></span><br><span class="line">  <span class="keyword">let</span> name = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">if</span> (firstName) &#123; <span class="comment">//if operator, +1</span></span><br><span class="line">    name = firstName;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (lastName) &#123; <span class="comment">// +1</span></span><br><span class="line">    name += <span class="string">' '</span> + lastName;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//even though complexity for getNameOrFallback is 2, it doesn't add up to complexity of current function</span></span><br><span class="line">  <span class="keyword">return</span> getNameOrFallback(name.trim(), <span class="string">'stranger'</span>);</span><br><span class="line">  <span class="comment">//total complexity is 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <p>When max complexity is set to 3 we can use at least two <code>if</code> operators, which is more than enough per function. Every time, when you run into situation, where you need complexity to be more than 3 - you need to refactor, move part of the logic into a separate function or both.</p> <h2 id="Refactoring_tips">Refactoring tips</h2><p>There are a few scenarios where you might be tempted to disable or increase max-complexity. It is always a bad decision, so let me show you a few examples and how code can be refactored to meet your standards.</p> <h3 id="Refactoring_a_switch-like_logic">Refactoring a switch-like logic</h3><p>Following example can be arbitrary complex:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMarkupForError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (error) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'validation-error'</span>:</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'network-error'</span>:</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'server-error'</span>:</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="comment">//... more cases</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">//...handle unknown error</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//arbitrary complex</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <p>The same example also can be re-written with if/if-else/else operators:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMarkupForError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error === <span class="string">'validation-error'</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (error === <span class="string">'network-error'</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (error === <span class="string">'server-error'</span>) &#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  <span class="comment">//...more conditions</span></span><br><span class="line">  <span class="keyword">else</span> &#123;<span class="comment">/*...handle unknown error*/</span>&#125;</span><br><span class="line">  <span class="comment">//arbitrary complex</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <p>In order to reduce complexity here you simply need to create a map object:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMarkupForError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> errorTypeToMarkupMap = &#123;</span><br><span class="line">    <span class="string">'validation-error'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">    <span class="string">'network-error'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;,</span><br><span class="line">    <span class="string">'server-error'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;<span class="comment">/*...*/</span>&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (errorTypeToMarkupMap.hasOwnProperty(error)) &#123;</span><br><span class="line">    <span class="keyword">return</span> errorTypeToMarkupMap[error];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*...handle unknown error*/</span></span><br><span class="line">  <span class="comment">//total complexity of this function will be 2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <h3 id="Refactoring_logic_which_follows_a_pattern">Refactoring logic which follows a pattern</h3><p>Following example is a bit more complex so we can’t use switch:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">highlightCurrentSection</span>(<span class="params">$t</span>) </span>&#123;</span><br><span class="line">  $t.find(<span class="string">'.menu__item'</span>).removeClass(<span class="string">'active'</span>);</span><br><span class="line">  <span class="keyword">let</span> pathname = <span class="built_in">window</span>.location.pathname;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/\/(books|livres)/i</span>.test(pathname)) &#123;</span><br><span class="line">    $t.find(<span class="string">'.menu__books'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/\/(baby|bebe)/i</span>.test(pathname)) &#123;</span><br><span class="line">    $t.find(<span class="string">'.menu__baby'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/\/(house-and-home|maison)/i</span>.test(pathname)) &#123;</span><br><span class="line">    $t.find(<span class="string">'.menu__houseandhome'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...more conditions</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/\/giftcards/i</span>.test(pathname)) &#123;</span><br><span class="line">    $t.find(<span class="string">'.menu__giftcards'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//arbitrary complex</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <p>We can see that branches are following a pattern - we check that regex is matching current location and add an <code>active</code> class to specified selector. The same code can be simplified if we create an array of objects, which contain a pattern and a selector and loop through it:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">highlightCurrentSection</span>(<span class="params">$t</span>) </span>&#123;</span><br><span class="line">  $t.find(<span class="string">'.menu__item'</span>).removeClass(<span class="string">'active'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> menuItems = [</span><br><span class="line">    &#123;pattern: <span class="regexp">/\/(books|livres)/i</span>, className: <span class="string">'.menu__books'</span>&#125;,</span><br><span class="line">    &#123;pattern: <span class="regexp">/\/(baby|bebe)/i</span>, className: <span class="string">'.menu__baby'</span>&#125;,</span><br><span class="line">    &#123;pattern: <span class="regexp">/\/(house-and-home|maison)/i</span>, className: <span class="string">'.menu__houseandhome'</span>&#125;,</span><br><span class="line">    &#123;pattern: <span class="regexp">/\/giftcards/i</span>, className: <span class="string">'.menu__giftcards'</span>&#125;</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">let</span> hasMatch = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">let</span> pathname = <span class="built_in">window</span>.location.pathname;</span><br><span class="line">  _.each(menuItems, <span class="function"><span class="keyword">function</span> <span class="title">addClassIfNeeded</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!hasMatch &amp;&amp; params.pattern.test(pathname)) &#123;</span><br><span class="line">      $t.find(params.className).addClass(<span class="string">'active'</span>);</span><br><span class="line">      hasMatch = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//total complexity of addClassIfNeeded is 2</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//total complexity of highlightCurrentSection function is 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <h3 id="Refactoring_logic_where_branches_have_similar_purpose">Refactoring logic where branches have similar purpose</h3><p>In following example we can see that branches inside lookupModule have the same purpose, but code inside conditions and inside branches doesn’t follow a pattern:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lookupModule</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sharedPathsConfig = <span class="built_in">require</span>(<span class="string">'../sharedPathsConfig'</span>);</span><br><span class="line">  <span class="keyword">let</span> overWritesForServer = <span class="string">'events'</span>;</span><br><span class="line">  <span class="keyword">let</span> map = &#123;react: <span class="string">'react/addons'</span>, jquery: overWritesForServer&#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/^\$.+/</span>.test(id)) &#123;</span><br><span class="line">    <span class="keyword">return</span> overWritesForServer;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (map[id]) &#123;</span><br><span class="line">    <span class="keyword">return</span> map[id];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (id <span class="keyword">in</span> sharedPathsConfig.paths) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.join(process.cwd(), sharedPathsConfig.paths[id]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...more conditions</span></span><br><span class="line">  <span class="keyword">return</span> id;</span><br><span class="line">  <span class="comment">//total complexity of lookupModule is arbitrary</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <p>On order to refactor this we can create an array of objects which contain a callback for condition and a callback for logic and iterate over it:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lookupModule</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> sharedPathsConfig = <span class="built_in">require</span>(<span class="string">'../sharedPathsConfig'</span>);</span><br><span class="line">  <span class="keyword">let</span> overWritesForServer = <span class="string">'events'</span>;</span><br><span class="line">  <span class="keyword">let</span> map = &#123;react: <span class="string">'react/addons'</span>, jquery: overWritesForServer&#125;;</span><br><span class="line">  <span class="keyword">let</span> lookupActions = [</span><br><span class="line">    &#123;</span><br><span class="line">      condition: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> <span class="regexp">/^\$.+/</span>.test(id);&#125;,</span><br><span class="line">      result: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> overWritesForServer;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      condition: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> map[id];&#125;,</span><br><span class="line">      result: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> map[id];&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      condition: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> id <span class="keyword">in</span> sharedPathsConfig.paths;&#125;,</span><br><span class="line">      result: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> path.join(process.cwd(), sharedPathsConfig.paths[id]);&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//...more conditions</span></span><br><span class="line">    &#123;</span><br><span class="line">      condition: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> <span class="literal">true</span>;&#125;,</span><br><span class="line">      result: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">//Symbol.iterator is used here for simplicity, you can use a polyfill function `makeIterator` from</span></span><br><span class="line">  <span class="comment">//https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators</span></span><br><span class="line">  <span class="keyword">let</span> actionsIterator = lookupActions[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">  <span class="keyword">let</span> result;</span><br><span class="line">  <span class="keyword">while</span> (!result) &#123;</span><br><span class="line">    <span class="keyword">let</span> action = actionsIterator.next().value;</span><br><span class="line">    <span class="keyword">if</span> (action.condition()) &#123;</span><br><span class="line">      result = action.result();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">  <span class="comment">//total complexity of lookupModule function is 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p> <h2 id="Final_thoughts">Final thoughts</h2><p>Cyclomatic complexity defines how many use cases we should keep in mind (and how many tests we need to create) while working with a program. It is important to keep cyclomatic complexity under control and as we could see with a little practice we can keep it low quite easily.</p> <p>I hope you liked this article. Please share your thoughts an tips in comments.</p> <h2 id="Links">Links</h2><p><a href="https://en.wikipedia.org/wiki/Cyclomatic_complexity" target="_blank" rel="external">Cyclomatic complexity</a> - Wikipedia<br><a href="http://eslint.org/docs/user-guide/integrations" target="_blank" rel="external">eslint integrations</a> with editors and build tools<br><a href="http://jshint.com/install/" target="_blank" rel="external">jshint integrations</a> with editors and build tools</p> <style>.article__title{font-size:32px}@media (max-width:540px){.article__title{font-size:25px}}</style><div id="disqus_thread"></div> </article> </div> <script>var disqus_shortname="webuniverse";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}();</script></main><footer id="page__footer" role="contentinfo"> All content, unless otherwise indicated, <span class="nowrap"> is licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank" rel="license">CC BY 4.0</a>. </span><br> <span itemscope itemtype="http://schema.org/Person" itemprop="author"> <a href="/about" itemprop="url"> <span itemprop="name">Sergey Zarouski</span></a> </span> &copy; <span itemprop="copyrightYear">2018</span>. </footer> </div> </div> </div> </div> <script>window.WebFontConfig={google:{families:["Slabo+27px"]}},function(){var t=document.createElement("script");t.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1.5.10/webfont.js",t.type="text/javascript",t.async="true";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script><script src="/bower_components/picturefill/dist/picturefill.min.js" async></script><script>!function(){var t="014578715170147478038:jt5g2str_f0",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https:":"http:")+"//www.google.com/cse/cse.js?cx="+t;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(e,c)}();</script><script>!function(e,n,a,t,o,c,s){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=n.createElement(a),s=n.getElementsByTagName(a)[0],c.async=1,c.src=t,s.parentNode.insertBefore(c,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),window.ga("create","UA-57969778-1","auto"),window.ga("send","pageview");</script><noscript><div class="noscript"> Javascript is disabled for this site in your browser. Please enable it if you want to see site in more interactive mode. To learn how click <a class="noscript-text--alternative" href="http://www.youtube.com/watch?v=0w8wr8a0r2M" target="_blank">here</a> or <a class="noscript-text--alternative" href="http://www.google.ca/search?q=how+to+enable+javascript&amp;tbs=vid:1" target="_blank">here</a>. </div></noscript> </body> 